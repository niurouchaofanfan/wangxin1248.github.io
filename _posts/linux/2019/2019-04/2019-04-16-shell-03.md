---
layout: post
title:  "shell 编程（三）：Shell脚本语法"
date:  2019-04-16
desc: "shell 脚本是系统运维的第一工具，今天来介绍下 shell 编程所涉及到的一些Shell脚本语法"
keywords: "shell,脚本,运维"
categories: [Linux]
tags: [Linux,shell]
---
# Shell 脚本语法

## 一、条件测试

在 shell 脚本中对某一个条件进行测试的命令是：**test 或者 [** ，该命令可以测试一个条件是否成立。

- 如果测试结果为真，则命令的Exit Status为 0
- 如果测试结果为假，则命令的Exit Status为 1（注意与C语言的逻辑表示正好相反）

例如测试两个数的大小关系：

```shell
wx@ubuntu:~/shell/01$ var=2
wx@ubuntu:~/shell/01$ test $var
wx@ubuntu:~/shell/01$ echo $?
0
wx@ubuntu:~/shell/01$ test $var -gt 5
wx@ubuntu:~/shell/01$ echo $?
1
wx@ubuntu:~/shell/01$ [ $var -gt 5 ]
wx@ubuntu:~/shell/01$ echo $?
1
wx@ubuntu:~/shell/01$ [ $var -gt 1 ]
wx@ubuntu:~/shell/01$ echo $?
0
```

虽然看起来很奇怪，但左方括号 /[ 确实是一个命令的名字，传给命令的各参数之间应该用空格隔开，比如，$VAR、-gt、3、] 是 /[ 命令的四个参数，它们之间必须用空格隔开。

命令 test 或 [ 的参数形式是相同的，只不过 test 命令不需要 ] 参数。

以 [ 命令为例，常见的测试命令如下所示：

```shell
[ -d DIR ]              如果DIR存在并且是一个目录则为真
[ -f FILE ]             如果FILE存在且是一个普通文件则为真
[ -z STRING ]           如果STRING的长度为零则为真
[ -n STRING ]           如果STRING的长度非零则为真
[ STRING1 = STRING2 ]   如果两个字符串相同则为真
[ STRING1 != STRING2 ]  如果字符串不相同则为真
[ ARG1 OP ARG2 ]        ARG1和ARG2应该是整数或者取值为整数的变量，OP是-eq（等于）-ne（不等于）-lt（小于）-le（小于等于）-gt（大于）-ge（大于等于）之中的一个
```

示例如下：

```shell
wx@ubuntu:~/shell/01$ mkdir test
wx@ubuntu:~/shell/01$ [ -d test ]
wx@ubuntu:~/shell/01$ echo $?
0
wx@ubuntu:~/shell/01$ [ -f test ]
wx@ubuntu:~/shell/01$ echo $?
1
wx@ubuntu:~/shell/01$ s1=hello
wx@ubuntu:~/shell/01$ s2=hello
wx@ubuntu:~/shell/01$ [ "$s1" = "$s2" ]
wx@ubuntu:~/shell/01$ echo $?
0
wx@ubuntu:~/shell/01$ s3=
wx@ubuntu:~/shell/01$ [ "$s1" = "$s3" ]
wx@ubuntu:~/shell/01$ echo $?
1
wx@ubuntu:~/shell/01$ [ "$s1" = $s3 ]
-bash: [: hello: unary operator expected
# 直接爆出语法错误，错误原因在于=右边需要一个字符串但是右边却是一个空，
# 也就是什么都没有，这样shell就会认为这是一个语法错误
# 正确的写法是在变量上加上双引号，这样展开也是一个空字符串
```

注意：

- 作为一种好的Shell编程习惯，应该总是把变量取值放在双引号之中。

shell 还和 c 语言一样也支持对测试条件之间进行 与、或、非 的逻辑运算：

```shell
# 非
[ ! EXPR ]          EXPR可以是上表中的任意一种测试条件，!表示逻辑反
# 与
[ EXPR1 -a EXPR2 ]  EXPR1和EXPR2可以是上表中的任意一种测试条件，-a表示逻辑与
# 或
[ EXPR1 -o EXPR2 ]  EXPR1和EXPR2可以是上表中的任意一种测试条件，-o表示逻辑或
```

例如：

```shell
wx@ubuntu:~/shell/01$ [ -d test -a "$var" = "abc" ]
wx@ubuntu:~/shell/01$ echo $?
1
wx@ubuntu:~/shell/01$ [ -d test -a "$var" = "test" ]
wx@ubuntu:~/shell/01$ echo $?
0
```

## 二、分支语句